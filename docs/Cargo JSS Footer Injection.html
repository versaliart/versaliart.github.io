<script>
(function () {
  // Tiny utility: wait for a selector to appear, then run once
  function whenSelector(selector, cb) {
    var el = document.querySelector(selector);
    if (el) return cb(el);
    var mo = new MutationObserver(function () {
      el = document.querySelector(selector);
      if (el) { mo.disconnect(); cb(el); }
    });
    mo.observe(document.documentElement, { childList: true, subtree: true });
  }

  // Load a script and return a Promise (for ordering/debugging)
  function loadScript(src, opts) {
    return new Promise(function (resolve, reject) {
      var s = document.createElement("script");
      if (opts && opts.type) s.type = opts.type; // e.g., {type:"module"}
      s.src = src;
      s.defer = !opts || !opts.type;
      s.onload = function(){ resolve(src); };
      s.onerror = function(e){ reject(new Error("Failed to load " + src)); };
      document.body.appendChild(s);
    });
  }

  // === Starfield ===
  whenSelector("#starfield-enable", function () {
    loadScript("https://versaliart.github.io/Cargo%20JSS%20Starfield.js")
      .then(()=>console.log("[Loader] Starfield loaded"))
      .catch(console.warn);
  });

  // === Tags ===
  whenSelector(".tag-pills", function () {
    loadScript("https://versaliart.github.io/Cargo%20JSS%20Tags.js")
      .then(()=>console.log("[Loader] Tags loaded"))
      .catch(console.warn);
  });

  // === Topblock flip ===
  whenSelector('.sqs-block.image-block a[href="#flip-top"]', function () {
    loadScript("https://versaliart.github.io/Cargo%20JSS%20Topblock%20flip.js")
      .then(()=>console.log("[Loader] Topblock loaded"))
      .catch(console.warn);
  });

  // === Header ===
  whenSelector('header#header[data-test="header"]', function () {
    loadScript("https://versaliart.github.io/Cargo%20JSS%20Header.js")
      .then(()=>console.log("[Loader] Header loaded"))
      .catch(console.warn);
  });

})();
</script>
